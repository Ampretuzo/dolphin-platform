<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">
<link rel="import" href="../bower_components/core-menu/core-submenu.html">
<link rel="import" href="../bower_components/font-awesome-polymer-icons/fa-icons.html">
<link rel="import" href="workflow-canvas.html">



<polymer-element name="workflow-menuentry" attributes="data" extends="core-item" on-click="{{buttonClick}}">
    <template>
        <shadow></shadow>
    </template>
    <script>
        Polymer({
            buttonClick: function() {
                dolphin.send('WorkflowController:showProcessInstance', {processInstance: this.data});
            }
        })
    </script>
</polymer-element>


<polymer-element name="workflow-start-button" attributes="data" extends="core-item">
    <template>
        <core-icon-button icon="fa:play" on-click="{{buttonClick}}"> <em>Start new process</em></core-icon-button>
    </template>
    <script>
        Polymer({
            buttonClick: function() {
                dolphin.send('WorkflowController:startProcessInstanceAndShow', {processDefinition: this.data});
            }
        })
    </script>
</polymer-element>


<polymer-element name="workflow-menu" attributes="data" noscript>
    <template>
        <core-menu>
            <template repeat="{{processDefinition in data.processDefinitions}}">
                <core-submenu label="{{processDefinition.name}}">
                    <workflow-start-button data="{{processDefinition}}"></workflow-start-button>
                    <template repeat="{{processInstance in processDefinition.processInstances}}">
                        <workflow-menuentry label="{{processInstance.label}}" data="{{processInstance}}"></workflow-menuentry>
                    </template>
                </core-submenu>
            </template>
        </core-menu>
    </template>
</polymer-element>


<polymer-element name="workflow-main-view" attributes="data" noscript>
    <template>
        <core-scaffold>
            <core-header-panel navigation flex mode="seamed">
                <core-toolbar>Dolphin Workflow</core-toolbar>
                <workflow-menu data="{{data.processList}}"></workflow-menu>
            </core-header-panel>
            <div tool>Process Instance {{data.processInstance.label}}</div>
            <workflow-canvas data="{{data.processInstance}}"></workflow-canvas>
        </core-scaffold>
    </template>
</polymer-element>
